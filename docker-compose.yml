version: '3'
services:

  nginx:
    image: nginx
    container_name: ""
    volumes:
      - ./client/build/:/usr/share/nginx/html:ro
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/conf.d:/etc/nginx/conf.d:ro
    links:
      - server:node_server
    depends_on:
      - "server"
    ports:
      - 8080:80
    networks:
      - backend

  client:
    image: node
    user: "node"
    working_dir: /home/node/app
    volumes:
      - ./client:/home/node/app
    ports:
      - 3000:3000
    command: "./entrypoint.sh"
    links:
      - server:node_server
    networks:
      - backend

  server:
    image: node
    user: "node"
    working_dir: /home/node/app
    volumes:
      - ./server:/home/node/app
    ports:
      - 3001:3000
    links:
      - mysql:db
    depends_on:
      - mysql
    networks:
      - backend
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
    command: "./entrypoint.sh"

  mysql:
    image: mysql
    volumes:
      - dbdata:/var/lib/mysql
    networks:
      - backend
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}

volumes:
  dbdata:

networks:
  backend:
